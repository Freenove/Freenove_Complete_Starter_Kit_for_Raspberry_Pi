using Microsoft.Extensions.Hosting; using Microsoft.Extensions.Logging; using System.Device.Spi; using Iot.Device.Mfrc522; using Iot.Device.Card;
var b=Host.CreateApplicationBuilder(args); b.Logging.AddConsole(); b.Services.AddHostedService<App>(); using var h=b.Build(); await h.RunAsync();
public sealed class App(ILogger<App> log):BackgroundService{ protected override async Task ExecuteAsync(CancellationToken ct){ using var spi=SpiDevice.Create(new SpiConnectionSettings(0,0)); using var r=new MfRc522(spi,25); log.LogInformation("Present card..."); while(!ct.IsCancellationRequested){ var card=r.ListenToCardIso14443TypeA(); if(card!=null){ log.LogInformation("UID {0}", BitConverter.ToString(card.NfcId).Replace("-","")); await Task.Delay(1000,ct);} await Task.Delay(200,ct);} } }